// Translations object
const translations = {
    en: {
        'hero.title': 'Stories and Insights from Around the World',
        'hero.subtitle': 'A space for global conversations, innovation, and ideas that connect cultures and inspire change',
        'hero.readLatest': 'Read Latest Posts',
        'hero.selectLanguage': 'Select Language',
        'posts.title': 'Latest Stories',
        'posts.readMore': 'Read More',
        'categories.title': 'Explore Topics',
        'categories.culture': 'Culture & Society',
        'categories.business': 'Business & Economy',
        'categories.innovation': 'Innovation & Tech',
        'categories.trends': 'Global Trends',
        'categories.sustainability': 'Sustainability',
        'categories.travel': 'Travel & Lifestyle',
        'categories.arts': 'Arts & Design',
        'categories.health': 'Health & Wellness',
        'featured.title': 'Featured Posts',
        'authors.title': 'Global Contributors',
        'partners.title': 'Our Partners',
        'newsletter.title': 'Stay Connected with Global Voices',
        'newsletter.subtitle': 'Get the latest stories and insights delivered to your inbox',
        'newsletter.namePlaceholder': 'Your Name',
        'newsletter.emailPlaceholder': 'Your Email',
        'newsletter.subscribe': 'Subscribe',
        'newsletter.privacy': 'We respect your privacy. Unsubscribe at any time.',
        'footer.description': 'Connecting cultures through stories',
        'footer.navigation': 'Navigation',
        'footer.home': 'Home',
        'footer.blog': 'Blog',
        'footer.about': 'About',
        'footer.contact': 'Contact',
        'footer.privacy': 'Privacy Policy',
        'footer.followUs': 'Follow Us',
        'footer.language': 'Language',
        'footer.rights': 'All rights reserved.',
        'about.title': 'About Global Voices',
        'about.description': 'We are a diverse community of writers, thinkers, and storytellers from around the world, united by our passion for sharing authentic perspectives and fostering cross-cultural understanding.',
        'about.contributors': 'Contributors',
        'about.countries': 'Countries',
        'about.languages': 'Languages',
        'about.readers': 'Monthly Readers',
        'about.missionTitle': 'Our Mission',
        'about.mission': 'To bridge cultural divides through authentic storytelling, promote global understanding, and amplify diverse voices that shape our interconnected world.',
        'about.global': 'Global Reach',
        'about.community': 'Diverse Community',
        'about.authentic': 'Authentic Stories'
    },
    fr: {
        'hero.title': 'Histoires et Perspectives du Monde Entier',
        'hero.subtitle': 'Un espace pour les conversations mondiales, l\'innovation et les idées qui connectent les cultures',
        'hero.readLatest': 'Lire les Derniers Articles',
        'hero.selectLanguage': 'Choisir la Langue',
        'posts.title': 'Dernières Histoires',
        'posts.readMore': 'Lire Plus',
        'categories.title': 'Explorer les Sujets',
        'categories.culture': 'Culture et Société',
        'categories.business': 'Affaires et Économie',
        'categories.innovation': 'Innovation et Tech',
        'categories.trends': 'Tendances Mondiales',
        'categories.sustainability': 'Durabilité',
        'categories.travel': 'Voyage et Style de Vie',
        'categories.arts': 'Arts et Design',
        'categories.health': 'Santé et Bien-être',
        'featured.title': 'Articles à la Une',
        'authors.title': 'Contributeurs Mondiaux',
        'partners.title': 'Nos Partenaires',
        'newsletter.title': 'Restez Connecté avec Global Voices',
        'newsletter.subtitle': 'Recevez les dernières histoires dans votre boîte mail',
        'newsletter.namePlaceholder': 'Votre Nom',
        'newsletter.emailPlaceholder': 'Votre Email',
        'newsletter.subscribe': 'S\'abonner',
        'newsletter.privacy': 'Nous respectons votre vie privée. Désabonnez-vous à tout moment.',
        'footer.description': 'Connecter les cultures à travers les histoires',
        'footer.navigation': 'Navigation',
        'footer.home': 'Accueil',
        'footer.blog': 'Blog',
        'footer.about': 'À Propos',
        'footer.contact': 'Contact',
        'footer.privacy': 'Politique de Confidentialité',
        'footer.followUs': 'Suivez-Nous',
        'footer.language': 'Langue',
        'footer.rights': 'Tous droits réservés.',
        'about.title': 'À Propos de Global Voices',
        'about.description': 'Nous sommes une communauté diverse d\'écrivains, penseurs et conteurs du monde entier, unis par notre passion de partager des perspectives authentiques et favoriser la compréhension interculturelle.',
        'about.contributors': 'Contributeurs',
        'about.countries': 'Pays',
        'about.languages': 'Langues',
        'about.readers': 'Lecteurs Mensuels',
        'about.missionTitle': 'Notre Mission',
        'about.mission': 'Combler les divisions culturelles par la narration authentique, promouvoir la compréhension mondiale et amplifier les voix diverses qui façonnent notre monde interconnecté.',
        'about.global': 'Portée Mondiale',
        'about.community': 'Communauté Diverse',
        'about.authentic': 'Histoires Authentiques'
    },
    es: {
        'hero.title': 'Historias e Ideas de Todo el Mundo',
        'hero.subtitle': 'Un espacio para conversaciones globales, innovación e ideas que conectan culturas',
        'hero.readLatest': 'Leer Últimas Publicaciones',
        'hero.selectLanguage': 'Seleccionar Idioma',
        'posts.title': 'Últimas Historias',
        'posts.readMore': 'Leer Más',
        'categories.title': 'Explorar Temas',
        'categories.culture': 'Cultura y Sociedad',
        'categories.business': 'Negocios y Economía',
        'categories.innovation': 'Innovación y Tecnología',
        'categories.trends': 'Tendencias Globales',
        'categories.sustainability': 'Sostenibilidad',
        'categories.travel': 'Viajes y Estilo de Vida',
        'categories.arts': 'Artes y Diseño',
        'categories.health': 'Salud y Bienestar',
        'featured.title': 'Publicaciones Destacadas',
        'authors.title': 'Colaboradores Globales',
        'partners.title': 'Nuestros Socios',
        'newsletter.title': 'Mantente Conectado con Global Voices',
        'newsletter.subtitle': 'Recibe las últimas historias en tu bandeja de entrada',
        'newsletter.namePlaceholder': 'Tu Nombre',
        'newsletter.emailPlaceholder': 'Tu Email',
        'newsletter.subscribe': 'Suscribirse',
        'newsletter.privacy': 'Respetamos tu privacidad. Cancela en cualquier momento.',
        'footer.description': 'Conectando culturas a través de historias',
        'footer.navigation': 'Navegación',
        'footer.home': 'Inicio',
        'footer.blog': 'Blog',
        'footer.about': 'Acerca de',
        'footer.contact': 'Contacto',
        'footer.privacy': 'Política de Privacidad',
        'footer.followUs': 'Síguenos',
        'footer.language': 'Idioma',
        'footer.rights': 'Todos los derechos reservados.',
        'about.title': 'Acerca de Global Voices',
        'about.description': 'Somos una comunidad diversa de escritores, pensadores y narradores de todo el mundo, unidos por nuestra pasión de compartir perspectivas auténticas y fomentar el entendimiento intercultural.',
        'about.contributors': 'Colaboradores',
        'about.countries': 'Países',
        'about.languages': 'Idiomas',
        'about.readers': 'Lectores Mensuales',
        'about.missionTitle': 'Nuestra Misión',
        'about.mission': 'Tender puentes entre divisiones culturales a través de narraciones auténticas, promover el entendimiento global y amplificar voces diversas que dan forma a nuestro mundo interconectado.',
        'about.global': 'Alcance Global',
        'about.community': 'Comunidad Diversa',
        'about.authentic': 'Historias Auténticas'
    },
    ar: {
        'hero.title': 'قصص ورؤى من حول العالم',
        'hero.subtitle': 'مساحة للمحادثات العالمية والابتكار والأفكار التي تربط الثقافات',
        'hero.readLatest': 'اقرأ أحدث المقالات',
        'hero.selectLanguage': 'اختر اللغة',
        'posts.title': 'أحدث القصص',
        'posts.readMore': 'اقرأ المزيد',
        'categories.title': 'استكشف المواضيع',
        'categories.culture': 'الثقافة والمجتمع',
        'categories.business': 'الأعمال والاقتصاد',
        'categories.innovation': 'الابتكار والتكنولوجيا',
        'categories.trends': 'الاتجاهات العالمية',
        'categories.sustainability': 'الاستدامة',
        'categories.travel': 'السفر ونمط الحياة',
        'categories.arts': 'الفنون والتصميم',
        'categories.health': 'الصحة والعافية',
        'featured.title': 'المشاركات المميزة',
        'authors.title': 'المساهمون العالميون',
        'partners.title': 'شركاؤنا',
        'newsletter.title': 'ابق على تواصل مع الأصوات العالمية',
        'newsletter.subtitle': 'احصل على أحدث القصص في صندوق بريدك',
        'newsletter.namePlaceholder': 'اسمك',
        'newsletter.emailPlaceholder': 'بريدك الإلكتروني',
        'newsletter.subscribe': 'اشترك',
        'newsletter.privacy': 'نحن نحترم خصوصيتك. يمكنك إلغاء الاشتراك في أي وقت.',
        'footer.description': 'ربط الثقافات من خلال القصص',
        'footer.navigation': 'التنقل',
        'footer.home': 'الرئيسية',
        'footer.blog': 'المدونة',
        'footer.about': 'حول',
        'footer.contact': 'اتصل',
        'footer.privacy': 'سياسة الخصوصية',
        'footer.followUs': 'تابعنا',
        'footer.language': 'اللغة',
        'footer.rights': 'جميع الحقوق محفوظة.',
        'about.title': 'حول الأصوات العالمية',
        'about.description': 'نحن مجتمع متنوع من الكتاب والمفكرين ورواة القصص من جميع أنحاء العالم، متحدون بشغفنا لمشاركة وجهات نظر أصيلة وتعزيز التفاهم بين الثقافات.',
        'about.contributors': 'المساهمون',
        'about.countries': 'البلدان',
        'about.languages': 'اللغات',
        'about.readers': 'القراء الشهريون',
        'about.missionTitle': 'مهمتنا',
        'about.mission': 'سد الفجوات الثقافية من خلال السرد الأصيل، وتعزيز التفاهم العالمي، وتضخيم الأصوات المتنوعة التي تشكل عالمنا المترابط.',
        'about.global': 'الوصول العالمي',
        'about.community': 'مجتمع متنوع',
        'about.authentic': 'قصص أصيلة'
    },
    zh: {
        'hero.title': '来自世界各地的故事与见解',
        'hero.subtitle': '全球对话、创新和连接文化的思想空间',
        'hero.readLatest': '阅读最新文章',
        'hero.selectLanguage': '选择语言',
        'posts.title': '最新故事',
        'posts.readMore': '阅读更多',
        'categories.title': '探索主题',
        'categories.culture': '文化与社会',
        'categories.business': '商业与经济',
        'categories.innovation': '创新与科技',
        'categories.trends': '全球趋势',
        'categories.sustainability': '可持续发展',
        'categories.travel': '旅行与生活方式',
        'categories.arts': '艺术与设计',
        'categories.health': '健康与保健',
        'featured.title': '精选帖子',
        'authors.title': '全球贡献者',
        'partners.title': '我们的合作伙伴',
        'newsletter.title': '与全球之声保持联系',
        'newsletter.subtitle': '在您的收件箱中获取最新故事和见解',
        'newsletter.namePlaceholder': '您的姓名',
        'newsletter.emailPlaceholder': '您的邮箱',
        'newsletter.subscribe': '订阅',
        'newsletter.privacy': '我们尊重您的隐私。随时可以取消订阅。',
        'footer.description': '通过故事连接文化',
        'footer.navigation': '导航',
        'footer.home': '首页',
        'footer.blog': '博客',
        'footer.about': '关于',
        'footer.contact': '联系',
        'footer.privacy': '隐私政策',
        'footer.followUs': '关注我们',
        'footer.language': '语言',
        'footer.rights': '版权所有。',
        'about.title': '关于全球之声',
        'about.description': '我们是一个来自世界各地的多元化作家、思想家和故事讲述者社区，我们因分享真实视角和促进跨文化理解的热情而团结在一起。',
        'about.contributors': '贡献者',
        'about.countries': '国家',
        'about.languages': '语言',
        'about.readers': '月读者',
        'about.missionTitle': '我们的使命',
        'about.mission': '通过真实的故事讲述弥合文化分歧，促进全球理解，放大塑造我们互联世界的多元声音。',
        'about.global': '全球覆盖',
        'about.community': '多元社区',
        'about.authentic': '真实故事'
    }
};

// Current language
let currentLanguage = 'en';

// DOM elements
let languageSelect;
let footerLanguageSelect;
let mobileMenuToggle;
let navLinks;

// Initialize the application
document.addEventListener('DOMContentLoaded', function() {
    // Initialize DOM elements
    languageSelect = document.getElementById('languageSelect');
    footerLanguageSelect = document.querySelector('.footer-language-select');
    mobileMenuToggle = document.querySelector('.mobile-menu-toggle');
    navLinks = document.querySelector('.nav-links');
    header = document.querySelector('.header');
    navLinksForScroll = document.querySelectorAll('.nav-links a[href^="#"]');
    sections = document.querySelectorAll('section[id]');
    
    initializeLanguage();
    setupEventListeners();
    setupSmoothScrolling();
    setupLazyLoading();
    setupNewsletterForm();
    setupHeroSlider();
});

// Language functionality
function initializeLanguage() {
    // Detect user's preferred language
    const browserLang = navigator.language.split('-')[0];
    const savedLang = localStorage.getItem('preferredLanguage');
    
    currentLanguage = savedLang || (translations[browserLang] ? browserLang : 'en');
    
    // Update select elements if they exist
    if (languageSelect) languageSelect.value = currentLanguage;
    if (footerLanguageSelect) footerLanguageSelect.value = currentLanguage;
    
    // Apply language
    changeLanguage(currentLanguage);
}

function changeLanguage(lang) {
    currentLanguage = lang;
    localStorage.setItem('preferredLanguage', lang);
    
    // Update HTML lang attribute
    document.documentElement.lang = lang;
    
    // Set text direction for RTL languages
    if (lang === 'ar') {
        document.documentElement.dir = 'rtl';
        document.body.style.fontFamily = "'Noto Sans Arabic', 'Inter', sans-serif";
    } else {
        document.documentElement.dir = 'ltr';
        document.body.style.fontFamily = "'Inter', sans-serif";
    }
    
    // Update all translatable elements
    const translatableElements = document.querySelectorAll('[data-translate]');
    translatableElements.forEach(element => {
        const key = element.getAttribute('data-translate');
        if (translations[lang] && translations[lang][key]) {
            element.textContent = translations[lang][key];
        }
    });
    
    // Update placeholder texts
    const placeholderElements = document.querySelectorAll('[data-translate-placeholder]');
    placeholderElements.forEach(element => {
        const key = element.getAttribute('data-translate-placeholder');
        if (translations[lang] && translations[lang][key]) {
            element.placeholder = translations[lang][key];
        }
    });
    
    // Update select elements if they exist
    if (languageSelect) languageSelect.value = lang;
    if (footerLanguageSelect) footerLanguageSelect.value = lang;
}

// Event listeners
function setupEventListeners() {
    // Language selectors
    if (languageSelect) {
        languageSelect.addEventListener('change', (e) => {
            changeLanguage(e.target.value);
        });
    }
    
    if (footerLanguageSelect) {
        footerLanguageSelect.addEventListener('change', (e) => {
            changeLanguage(e.target.value);
        });
    }
    
    // Mobile menu toggle
    if (mobileMenuToggle) {
        mobileMenuToggle.addEventListener('click', toggleMobileMenu);
    }
    
    // Close mobile menu when clicking outside
    document.addEventListener('click', (e) => {
        if (navLinks && !e.target.closest('.nav') && navLinks.classList.contains('mobile-open')) {
            toggleMobileMenu();
        }
    });
    
    // Hero buttons
    const readLatestBtn = document.querySelector('.btn-primary');
    readLatestBtn.addEventListener('click', () => {
        document.getElementById('blog').scrollIntoView({ behavior: 'smooth' });
    });
    
    // Category cards
    const categoryCards = document.querySelectorAll('.category-card');
    categoryCards.forEach(card => {
        card.addEventListener('click', () => {
            // Simulate category filtering
            console.log('Category clicked:', card.querySelector('h3').textContent);
        });
    });
}

// Mobile menu functionality
function toggleMobileMenu() {
    if (!navLinks || !mobileMenuToggle) return;
    
    navLinks.classList.toggle('mobile-open');
    const icon = mobileMenuToggle.querySelector('i');
    if (icon) {
        icon.classList.toggle('fa-bars');
        icon.classList.toggle('fa-times');
    }
}

// Smooth scrolling for navigation links
function setupSmoothScrolling() {
    const navLinksElements = document.querySelectorAll('.nav-links a[href^="#"]');
    navLinksElements.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const targetId = link.getAttribute('href').substring(1);
            const targetElement = document.getElementById(targetId);
            
            if (targetElement) {
                targetElement.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
            
            // Close mobile menu if open
            if (navLinks && navLinks.classList.contains('mobile-open')) {
                toggleMobileMenu();
            }
        });
    });
}

// Hero Slider functionality
function setupHeroSlider() {
    const sliderWrapper = document.querySelector('.hero-slider .slider-wrapper');
    const sliderDotsContainer = document.querySelector('.hero-slider .slider-dots');
    
    if (!sliderWrapper || !sliderDotsContainer) return;

    // Sample slider data
    const sliderData = [
        {
            image: 'https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=400&h=250&fit=crop',
            title: 'Bridging Cultures Through Technology',
            author: 'Maria Rodriguez',
            date: 'Dec 15, 2024',
            excerpt: 'How digital platforms are creating new opportunities for cross-cultural collaboration...'
        },
        {
            image: 'https://images.unsplash.com/photo-1451187580459-43490279c0fa?w=400&h=250&fit=crop',
            title: 'Sustainable Innovation Across Continents',
            author: 'Ahmed Hassan',
            date: 'Dec 12, 2024',
            excerpt: 'Exploring groundbreaking environmental solutions from different corners of the world...'
        },
        {
            image: 'https://images.unsplash.com/photo-1522202176988-66273c2fd55f?w=400&h=250&fit=crop',
            title: 'The Future of Global Commerce',
            author: 'Li Wei',
            date: 'Dec 10, 2024',
            excerpt: 'Understanding emerging markets and their impact on international trade patterns...'
        }
    ];

    // Create slides
    sliderData.forEach((data, index) => {
        const slide = document.createElement('div');
        slide.className = 'post-card';
        slide.innerHTML = `
            <img src="${data.image}" alt="${data.title}" loading="lazy">
            <div class="post-content">
                <h3>${data.title}</h3>
                <div class="post-meta">
                    <span class="author">${data.author}</span>
                    <span class="date">${data.date}</span>
                </div>
                <p class="excerpt">${data.excerpt}</p>
                <a href="#" class="read-more">Read More</a>
            </div>
        `;
        sliderWrapper.appendChild(slide);
        
        // Create dot
        const dot = document.createElement('button');
        dot.className = `slider-dot ${index === 0 ? 'active' : ''}`;
        dot.addEventListener('click', () => {
            currentSlide = index;
            updateSlider();
        });
        sliderDotsContainer.appendChild(dot);
    });

    const prevBtn = document.querySelector('.hero-slider .prev-btn');
    const nextBtn = document.querySelector('.hero-slider .next-btn');
    const dots = document.querySelectorAll('.hero-slider .slider-dot');
    let currentSlide = 0;
    let slideInterval;

    function updateSlider() {
        sliderWrapper.style.transform = `translateX(-${currentSlide * 100}%)`;
        dots.forEach((dot, index) => {
            dot.classList.toggle('active', index === currentSlide);
        });
        resetInterval();
    }

    function showNextSlide() {
        currentSlide = (currentSlide + 1) % sliderData.length;
        updateSlider();
    }

    function showPrevSlide() {
        currentSlide = (currentSlide - 1 + sliderData.length) % sliderData.length;
        updateSlider();
    }

    function startInterval() {
        slideInterval = setInterval(showNextSlide, 5000);
    }

    function resetInterval() {
        clearInterval(slideInterval);
        startInterval();
    }

    if (prevBtn) prevBtn.addEventListener('click', showPrevSlide);
    if (nextBtn) nextBtn.addEventListener('click', showNextSlide);

    // Pause on hover
    const heroSlider = document.querySelector('.hero-slider');
    if (heroSlider) {
        heroSlider.addEventListener('mouseenter', () => clearInterval(slideInterval));
        heroSlider.addEventListener('mouseleave', startInterval);
    }

    startInterval();
}
// Lazy loading for images
function setupLazyLoading() {
    const images = document.querySelectorAll('img[loading="lazy"]');
    
    if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    img.src = img.src;
                    img.classList.remove('lazy');
                    imageObserver.unobserve(img);
                }
            });
        });
        
        images.forEach(img => imageObserver.observe(img));
    }
}

// Newsletter form functionality
function setupNewsletterForm() {
    const newsletterForm = document.querySelector('.newsletter-form');
    
    newsletterForm.addEventListener('submit', (e) => {
        e.preventDefault();
        
        const formData = new FormData(newsletterForm);
        const name = formData.get('name') || newsletterForm.querySelector('input[type="text"]').value;
        const email = formData.get('email') || newsletterForm.querySelector('input[type="email"]').value;
        
        // Basic validation
        if (!name || !email) {
            showNotification('Please fill in all fields', 'error');
            return;
        }
        
        if (!isValidEmail(email)) {
            showNotification('Please enter a valid email address', 'error');
            return;
        }
        
        // Simulate newsletter subscription
        showNotification('Thank you for subscribing!', 'success');
        newsletterForm.reset();
    });
}

// Email validation
function isValidEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
}

// Notification system
function showNotification(message, type = 'info') {
    // Remove existing notifications
    const existingNotification = document.querySelector('.notification');
    if (existingNotification) {
        existingNotification.remove();
    }
    
    // Create notification element
    const notification = document.createElement('div');
    notification.className = `notification notification-${type}`;
    notification.textContent = message;
    
    // Add styles
    notification.style.cssText = `
        position: fixed;
        top: 100px;
        right: 20px;
        background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
        color: white;
        padding: 1rem 1.5rem;
        border-radius: 8px;
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        z-index: 1001;
        transform: translateX(100%);
        transition: transform 0.3s ease;
    `;
    
    document.body.appendChild(notification);
    
    // Animate in
    setTimeout(() => {
        notification.style.transform = 'translateX(0)';
    }, 100);
    
    // Remove after 3 seconds
    setTimeout(() => {
        notification.style.transform = 'translateX(100%)';
        setTimeout(() => {
            if (notification.parentNode) {
                notification.remove();
            }
        }, 300);
    }, 3000);
}

// Scroll animations
function setupScrollAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };
    
    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);
    
    // Observe elements for animation
    const animatedElements = document.querySelectorAll('.post-card, .category-card, .author-card');
    animatedElements.forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(el);
    });
}

// Initialize scroll animations after DOM is loaded
document.addEventListener('DOMContentLoaded', setupScrollAnimations);

// Performance optimization: Debounce scroll events
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Header scroll effect with active section highlighting
let header;
let navLinksForScroll;
let sections;

const handleScroll = debounce(() => {
    // Header background effect
    if (header && window.scrollY > 100) {
        header.style.background = 'rgba(255, 255, 255, 0.98)';
        header.style.boxShadow = '0 2px 20px rgba(0, 0, 0, 0.1)';
    } else if (header) {
        header.style.background = 'rgba(255, 255, 255, 0.95)';
        header.style.boxShadow = 'none';
    }
    
    // Active section highlighting
    if (navLinksForScroll && sections) {
        let current = '';
        sections.forEach(section => {
            const sectionTop = section.offsetTop - 150;
            const sectionHeight = section.offsetHeight;
            if (window.scrollY >= sectionTop && window.scrollY < sectionTop + sectionHeight) {
                current = section.getAttribute('id');
            }
        });
        
        navLinksForScroll.forEach(link => {
            link.classList.remove('active');
            if (link.getAttribute('href') === `#${current}`) {
                link.classList.add('active');
            }
        });
    }
}, 10);

window.addEventListener('scroll', handleScroll);

// Accessibility improvements
document.addEventListener('keydown', (e) => {
    // Skip to main content with Tab key
    if (e.key === 'Tab' && !e.shiftKey && document.activeElement === document.body) {
        const mainContent = document.querySelector('.hero');
        if (mainContent) {
            mainContent.focus();
        }
    }
    
    // Close mobile menu with Escape key
    if (e.key === 'Escape' && navLinks && navLinks.classList.contains('mobile-open')) {
        toggleMobileMenu();
    }
});

// Add mobile menu styles dynamically
const mobileMenuStyles = `
    @media (max-width: 768px) {
        .nav-links.mobile-open {
            display: flex;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            flex-direction: column;
            padding: 1rem 2rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            border-top: 1px solid var(--border);
        }
        
        .nav-links.mobile-open a {
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border);
        }
        
        .nav-links.mobile-open .language-selector {
            margin-top: 1rem;
        }
    }
`;

// Inject mobile menu styles and slider dot styles
const styleSheet = document.createElement('style');
styleSheet.textContent = mobileMenuStyles + `
.slider-dot {
    border: none;
    background: #cbd5e1;
    width: 10px;
    height: 10px;
    border-radius: 50%;
    cursor: pointer;
    transition: all 0.3s ease;
    margin: 0 4px;
}
.slider-dot.active {
    background: var(--primary-color);
}
`;
document.head.appendChild(styleSheet);